## -*- coding: utf-8 -*- 
<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
  <title>
this.title
</title>
  <link rel="stylesheet" href="./static/css/pure-min.css">
  <link rel="stylesheet" href="./static/css/style.css" />
  <link rel="stylesheet" href="./static/css/pygments.css" />
</head>
<body>
  <div id="main" class="pure-g">
    <header class="sidebar pure-u-7-24">
      <div class="top">
        <a class="blog-title" href=""><span class="blog-desc">个人博客</span></a>
        <ul class="menu contact">
          <li><a href="">Github</a></li>
        </ul>         
      </div>
      <div class="bottom">
        <ul class="menu nav">
          <li><a href="" title="">主页</a></li>
          <li><a href="" title="">LIST</a></li>
        </ul>
      </div>
    </header>
    <section class="content pure-u-17-24">
      <div class="content-inner">
      
	<article>
		<section>
      		<hr />
<p>layout: post<br />
title: "初学sed"<br />
date: 2014-04-08 22:41:41 -0400<br />
comments: true<br />
categories: [sed]  </p>
<hr />
<h1>1、什么是sed。</h1>
<p>linux用三大文本处理利器：grep，sed，awk。<br />
Sed：stream editor，流编辑器<br />
简单来说就是一个编辑器，但是和vim不同，vim是把一个文件打开编辑然后存盘，而sed是从文件中读取一行出来处理，一行一行的处理，所以称之为流。<br />
<!-- more --></p>
<h1>2、如何使用sed。</h1>
<p>在学习使用sed之前，必须先明白sed的几个概念。<br />
sed的工作流程：sed到文件中读取一行文字到内存中，然后在按指定的规则来处理这一行文字，处理完之后再去读取下一行文字到内存，再出来，一直这样下去，每次操作对象都是单独的一行。其实sed可以操作多行，但是有点点复杂，我们这里只讨论一行的。<br />
模式空间：sed每次加载一行文字到内存中操作，而这块操作空间就称为模式空间。<br />
补充：sed默认是不更改源文件，而是把它读取到内存操作之后送的屏幕，不会保存到源文件中，除非指定-i选项。<br />
sed的基本语法：sed [option] '[定位][操作]' 文件<br />
简单实例：把/etc/inittab中的第3行到第15行删除。<br />
 <code> 
    # sed '3,15d' test.txt<br />
    1   # inittab is only used by upstart for the default runlevel.<br />
    2   #<br />
    16  #<br />
    17  # Default runlevel. The runlevels used are:<br />
    18  #   0 - halt (Do NOT set initdefault to this)<br />
    19  #   1 - Single user mode<br />
    20  #   2 - Multiuser, without NFS (The same as 3, if you do not have networking)<br />
    21  #   3 - Full multiuser mode<br />
    22  #   4 - unused<br />
    23  #   5 - X11<br />
    24  #   6 - reboot (Do NOT set initdefault to this)<br />
    25  # <br />
    26  id:3:initdefault:<br />
</code>
为了方便观察，我在文件加了行号。<br />
从上面的结果我们可以看出3-15行被删除了。<br />
单引号中用两个内容，分别是定位和操作，这个实例中的定位就3,15，操作就是d。<br />
sed中有哪些定位方式呢？<br />
sed地址定界：<br />
start_line,end_line: 例如1,7<br />
start_line,/pattern/: 例如3,/^#/<br />
/pattern/: 仅匹配被模式到的行；<br />
地址定位是可以使用正则表达式的，正则表达式放着//之间，sed默认使用基本正则表达式。<br />
sed的常用操作命令：<br />
p: 打印<br />
d: 删除<br />
a \text：在符合条件的行后面添加指定的内容；在的添加的内容中间使用“\n”能够完成多行附加；<br />
i \text：在符合条件的行前面添加指定的内容；在的添加的内容中间使用“\n”能够完成多行附加；<br />
c \text: 将符合条件的行替换为指定的文本；<br />
r /path/to/somefile: 在符合条件的位置读入指定的文件；<br />
w /path/to/somefile: 将符合条件的行保存至指定文件中；<br />
=: 显示匹配到的行的行号；  </p>
<p>s/要查找的内容/替换为的内容/：<br />
要查找的内容：可以使用正则模式<br />
替换为的内容：不可以使用模式，但可以引用, &amp;<br />
和vim中一样，s后的三个标记符号可以使用任意字符，比如：s#old#new#<br />
和vim的替换一样，最后一个标记符后个加选项：<br />
i: 忽略大小写<br />
g：全局替换<br />
如：s#old#new#g  </p>
<p>sed的常用选项：<br />
sed默认是将加载到内存的内容处理了送到屏幕(d操作的例外)。<br />
我们还可以给定一些选项，让它改变默认操作<br />
-n: 静默模式，即不输出模式空间中的内容；<br />
-e: 指定在一个sed命令中使用多个script，格式为-e 'script1' -e 'script2' ...<br />
-i: 直接修改原文件；<br />
-r: 支持使用扩展正则表达式元字符；<br />
-f /path/to/sed_script: 从文件中读取处理脚本，并执行；<br />
3、练习<br />
(1) 文件中有以下内容：<br />
<code>He like his liker.  
He like his lover.  
She love her liker.  
She love her lover.</code>  </p>
<p>1)、删除上述内容中l..e前后一致的行；<br />
~~~~{bash}</p>
<h1>sed '/(l..e).*\1/d' t.txt</h1>
<p>he like his lover.<br />
she love her liker.<br />
~~~~</p>
<p>2)、将上述内容中l..e前后一致的后面的l改为大写L；<br />
```bash  </p>
<h1>sed '/(l..e).*\1r/s#l#L#2g' t.txt</h1>
<p>he like his Liker.<br />
he like his lover.<br />
she love her liker.<br />
she love her Lover.<br />
```  </p>
<p>(2)、删除/etc/grub.conf文件中行首的空白符；<br />
```bash  </p>
<h1>sed '/^[[:space:]]{1,}/s/^[[:space:]]{1,}//' grub.conf</h1>
<h1>grub.conf generated by anaconda</h1>
<h1></h1>
<h1>Note that you do not have to rerun grub after making changes to this file</h1>
<h1>NOTICE:  You have a /boot partition.  This means that</h1>
<h1>all kernel and initrd paths are relative to /boot/, eg.</h1>
<h1>root (hd0,0)</h1>
<h1>kernel /vmlinuz-version ro root=/dev/mapper/vg_livecd-lv_root</h1>
<h1>initrd /initrd-[generic-]version.img</h1>
<h1>boot=/dev/sda</h1>
<p>default=0<br />
timeout=5<br />
splashimage=(hd0,0)/grub/splash.xpm.gz<br />
hiddenmenu<br />
title CentOS (2.6.32-431.el6.x86_64)<br />
root (hd0,0)<br />
kernel /vmlinuz-2.6.32-431.el6.x86_64 ro root=/dev/mapper/vg_livecd-lv_root rd_NO_LUKS LANG=en_US.UTF-8 rd_LVM_LV=vg_livecd/lv_swap rd_NO_MD rd_LVM_LV=vg_livecd/lv_root SYSFONT=latarcyrheb-sun16 crashkernel=128M  KEYBOARDTYPE=pc KEYTABLE=us rd_NO_DM rhgb quiet<br />
initrd /initramfs-2.6.32-431.el6.x86_64.img     <br />
```  </p>
<p>(3)、删除/etc/inittab文件中开头的#号;<br />
```bash  </p>
<h1>sed '/^#/s/#//' inittab</h1>
<p>inittab is only used by upstart for the default runlevel.  </p>
<p>ADDING OTHER CONFIGURATION HERE WILL HAVE NO EFFECT ON YOUR SYSTEM.  </p>
<p>System initialization is started by /etc/init/rcS.conf  </p>
<p>Individual runlevels are started by /etc/init/rc.conf  </p>
<p>Ctrl-Alt-Delete is handled by /etc/init/control-alt-delete.conf  </p>
<p>Terminal gettys are handled by /etc/init/tty.conf and /etc/init/serial.conf,<br />
with configuration in /etc/sysconfig/init.  </p>
<p>For information on how to write upstart event handlers, or how<br />
upstart works, see init(5), init(8), and initctl(8).  </p>
<p>Default runlevel. The runlevels used are:<br />
0 - halt (Do NOT set initdefault to this)<br />
1 - Single user mode<br />
2 - Multiuser, without NFS (The same as 3, if you do not have networking)<br />
3 - Full multiuser mode<br />
4 - unused<br />
5 - X11<br />
6 - reboot (Do NOT set initdefault to this)  </p>
<p>id:3:initdefault:<br />
```  </p>
<p>附加练习题：<br />
1、删除某文件中开头的#号及后面的空白字符，但要求#号后面必须有空白字符;<br />
```bash  </p>
<h1>sed '/(^#[[:space:]]{1,})/s/^#[[:space:]]*//' file</h1>
<p>```  </p>
<p>2、删除某文件中以空白字符后面跟#类的行中的开头的空白字符及#<br />
```bash  </p>
<h1>sed '/^[[:space:]]{1,}#/s/^[[:space:]]{1,}#//' file</h1>
<p>```  </p>
		</section>				
	</article>

        <footer>
          <p>Copyright <a href="">MPress</a> © 2014 • All right reserved.</p>
        </footer>
      <div>
    </section>
  </div>
</body>